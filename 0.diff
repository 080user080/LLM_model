--- a/sfx_tagger.py
+++ b/sfx_tagger.py
@@
-import re
-import os
-import shutil
-from tkinter import Tk, filedialog
-from datetime import datetime
+import re
+import os
+import shutil
+from tkinter import Tk, filedialog
+from datetime import datetime
+import yaml
@@
-SFX_MAP = [
-    # ----------------------------------------------------
-    # 1. СТРУКТУРНІ ТЕГИ (precede_line) - Включено #p2 після #r
-    # ----------------------------------------------------
-    {
-        "tag": "#r",
-        # Шукає "РОЗДІЛ X", "ЧАСТИНА III" або просто "ГЛАВА".
-        "keywords": re.compile(r"^\s*(РОЗДІЛ|ЧАСТИНА|ГЛАВА)\s*([IVXLCDM\d]+\.?|\s*)$", re.IGNORECASE | re.MULTILINE),
-        "confidence": 1.0,
-        "position": "precede_line",
-        "post_tag": "#p2", # Додаємо #p2 після заголовка (на тому ж рядку)
-        "description": "Розділ/Глава + Пауза"
-    },
-    # ----------------------------------------------------
-    # 2. ТЕГИ ДІЇ/ЕФЕКТУ (after_match_newline)
-    # ----------------------------------------------------
-    {
-        "tag": "#d",
-        "keywords": re.compile(r"(\w+\s+(відчинив|зачинив|заскрипіли|стук у)\s+двері)", re.IGNORECASE),
-        "confidence": 0.95,
-        "position": "after_match_newline",
-        "description": "Двері/Скрип"
-    },
-    {
-        "tag": "#v",
-        "keywords": re.compile(r"(прогримів вибух|голосно бахнуло|постріл пролунав|грім вдарив|крик пролунав)", re.IGNORECASE),
-        "confidence": 0.9,
-        "position": "after_match_newline",
-        "description": "Вибух/Постріл/Різка дія"
-    },
-    {
-        "tag": "#heart",
-        "keywords": re.compile(r"(серце шалено калатало|прискорене серцебиття|завмерло серце|жах охопив)", re.IGNORECASE),
-        "confidence": 0.85,
-        "position": "after_match_newline",
-        "description": "Серцебиття/Напруга"
-    },
-    {
-        "tag": "#rain",
-        "keywords": re.compile(r"(за вікном зашумів дощ|тихо падає дощ|шум дощу|вітер завив)", re.IGNORECASE),
-        "confidence": 0.8,
-        "position": "after_match_newline",
-        "description": "Дощ/Вітер (Атмосфера)"
-    },
-    {
-        "tag": "#step",
-        "keywords": re.compile(r"(кроки пролунали|чути кроки|ступив на підлогу|тихий стукіт каблуків)", re.IGNORECASE),
-        "confidence": 0.8,
-        "position": "after_match_newline",
-        "description": "Кроки/Рух"
-    },
-]
+def _flags_from_str(flag_str: str):
+    """Конвертує рядок флагів з YAML у re-флаги."""
+    if not flag_str:
+        return 0
+    mapping = {
+        "IGNORECASE": re.IGNORECASE,
+        "MULTILINE": re.MULTILINE,
+        "DOTALL": re.DOTALL,
+        "VERBOSE": re.VERBOSE,
+    }
+    flags = 0
+    # допускаємо формати: "IGNORECASE|MULTILINE" або "IGNORECASE"
+    for part in re.split(r'\s*\|\s*', flag_str):
+        part = part.strip()
+        if part in mapping:
+            flags |= mapping[part]
+    return flags
+
+def load_sfx_from_yaml(path='sfx_tags.yaml'):
+    """Завантажує правила з YAML і повертає список правил з компільованими regex."""
+    if not os.path.exists(path):
+        return None
+    try:
+        with open(path, 'r', encoding='utf-8') as f:
+            cfg = yaml.safe_load(f)
+    except Exception as e:
+        print(f"⚠️ Помилка читання YAML {path}: {e}")
+        return None
+
+    rules = []
+    # очікуємо розділи 'structural' і 'actions'
+    for section in ('structural', 'actions'):
+        items = cfg.get(section) or []
+        for it in items:
+            pattern = it.get('keywords')
+            flags_raw = it.get('flags') or ''
+            flags = _flags_from_str(flags_raw)
+            try:
+                compiled = re.compile(pattern, flags)
+            except Exception as e:
+                print(f"⚠️ Помилка компіляції regex для тегу {it.get('tag')}: {e}")
+                continue
+            rule = {
+                "tag": it.get('tag'),
+                "keywords": compiled,
+                "confidence": float(it.get('confidence', 0.5)),
+                "position": it.get('position', 'after_match_newline'),
+            }
+            # переносимо додаткові поля (post_tag, description)
+            for add in ('post_tag', 'description'):
+                if add in it:
+                    rule[add] = it[add]
+            rules.append(rule)
+    return rules
+
+# Спробуємо завантажити sfx_tags.yaml. Якщо не вдалось — використаємо хардкод як fallback.
+_loaded = load_sfx_from_yaml('sfx_tags.yaml')
+if _loaded:
+    SFX_MAP = _loaded
+else:
+    SFX_MAP = [
+        # старий хардкод fallback
+        {
+            "tag": "#r",
+            "keywords": re.compile(r"^\s*(РОЗДІЛ|ЧАСТИНА|ГЛАВА)\s*([IVXLCDM\d]+\.?|\s*)$", re.IGNORECASE | re.MULTILINE),
+            "confidence": 1.0,
+            "position": "precede_line",
+            "post_tag": "#p2",
+            "description": "Розділ/Глава + Пауза"
+        },
+        {
+            "tag": "#d",
+            "keywords": re.compile(r"(\w+\s+(відчинив|зачинив|заскрипіли|стук у)\s+двері)", re.IGNORECASE),
+            "confidence": 0.95,
+            "position": "after_match_newline",
+            "description": "Двері/Скрип"
+        },
+        {
+            "tag": "#v",
+            "keywords": re.compile(r"(прогримів вибух|голосно бахнуло|постріл пролунав|грім вдарив|крик пролунав)", re.IGNORECASE),
+            "confidence": 0.9,
+            "position": "after_match_newline",
+            "description": "Вибух/Постріл/Різка дія"
+        },
+    ]
