import json
from pathlib import Path
from datetime import datetime, timedelta
from colorama import Fore

class CacheManager:
    """–ú–µ–Ω–µ–¥–∂–µ—Ä –∫–µ—à—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π"""
    
    def __init__(self, cache_duration_hours=24):
        self.cache_file = Path(__file__).parent / "cache_data.json"
        self.cache_duration = timedelta(hours=cache_duration_hours)
        self.cache = self._load_cache()
        print(f"{Fore.MAGENTA}üíæ –ö–µ—à: {len(self.cache)} –∑–∞–ø–∏—Å—ñ–≤")
    
    def _load_cache(self):
        """–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–µ—à –∑ —Ñ–∞–π–ª—É"""
        if self.cache_file.exists():
            try:
                with open(self.cache_file, 'r', encoding='utf-8') as f:
                    return json.load(f)
            except:
                return {}
        return {}
    
    def _save_cache(self):
        """–ó–±–µ—Ä–µ–≥—Ç–∏ –∫–µ—à"""
        try:
            with open(self.cache_file, 'w', encoding='utf-8') as f:
                json.dump(self.cache, f, ensure_ascii=False, indent=2)
        except Exception as e:
            print(f"{Fore.RED}‚ùå –ü–æ–º–∏–ª–∫–∞ –∫–µ—à—É: {e}")
    
    def get(self, command):
        """–û—Ç—Ä–∏–º–∞—Ç–∏ –∑ –∫–µ—à—É"""
        key = command.lower().strip()
        
        if key in self.cache:
            entry = self.cache[key]
            timestamp = datetime.fromisoformat(entry['timestamp'])
            
            if datetime.now() - timestamp < self.cache_duration:
                entry['hits'] = entry.get('hits', 0) + 1
                self._save_cache()
                return entry['response']
            else:
                del self.cache[key]
                self._save_cache()
        
        return None
    
    def set(self, command, response):
        """–î–æ–¥–∞—Ç–∏ –≤ –∫–µ—à"""
        key = command.lower().strip()
        self.cache[key] = {
            'response': response,
            'timestamp': datetime.now().isoformat(),
            'hits': 0
        }
        self._save_cache()

def init():
    pass
# ```

## –ö–ª—é—á–æ–≤—ñ –∑–º—ñ–Ω–∏:

### ‚úÖ **–ê–∫—Ç–∏–≤–∞—Ü—ñ—è —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
#- –°–ª—É—Ö–∞—î –ø–æ—Å—Ç—ñ–π–Ω–æ (4 —Å–µ–∫ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∏)
#- –ü–æ–∫–∞–∑—É—î —Å—ñ—Ä–∏–º —Ç–µ–∫—Å—Ç–æ–º —â–æ —á—É—î
#- **–ê–∫—Ç–∏–≤—É—î—Ç—å—Å—è –¢–Ü–õ–¨–ö–ò –Ω–∞ "–ö–õ–ê–†–ê"** (–ª–µ–≥–∫–æ –≤–∏–º–æ–≤–ª—è—Ç–∏ —ñ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î—Ç—å—Å—è)
#- –î–≤–∞ —Ä–µ–∂–∏–º–∏:
#  - "–ö–ª–∞—Ä–∞ –≤—ñ–¥–∫—Ä–∏–π –±–ª–æ–∫–Ω–æ—Ç" - –≤–∏–∫–æ–Ω—É—î –æ–¥—Ä–∞–∑—É
#  - "–ö–ª–∞—Ä–∞" (–ø–∞—É–∑–∞) - —á–µ–∫–∞—î –∫–æ–º–∞–Ω–¥—É 6 —Å–µ–∫—É–Ω–¥

### ‚úÖ **–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –ø–æ–º–∏–ª–∫–æ–≤–∏—Ö —Å–ø—Ä–∞—Ü—é–≤–∞–Ω—å:**
#- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≥—É—á–Ω–æ—Å—Ç—ñ (—ñ–≥–Ω–æ—Ä—É—î —Ç–∏—à—É)
#- –ß—ñ—Ç–∫–µ –∞–∫—Ç–∏–≤–∞—Ü—ñ–π–Ω–µ —Å–ª–æ–≤–æ
#- –ù–µ —Ä–µ–∞–≥—É—î –Ω–∞ —Ñ–æ–Ω–æ–≤–∏–π —à—É–º –∑ –¥–∏–Ω–∞–º—ñ–∫—ñ–≤

### ‚úÖ **–ü–æ—Ä—è–¥–æ–∫ core_ –º–æ–¥—É–ª—ñ–≤:**
#- –ó–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –≤ **–∞–ª—Ñ–∞–≤—ñ—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É** —ñ–º–µ–Ω—ñ —Ñ–∞–π–ª—É
#- –ú–æ–∂–µ—à –Ω–∞–∑–∏–≤–∞—Ç–∏: `core_01_dispatcher.py`, `core_02_cache.py`
#- –ê–±–æ –ø—Ä–æ—Å—Ç–æ `core_dispatcher.py` - –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∏–π

### üéØ **–Ø–∫ –ø—Ä–∞—Ü—é—î:**

# –°–ª—É—Ö–∞—î  –ß—É—î "–∫–ª–∞—Ä–∞ –≤—ñ–¥–∫—Ä–∏–π –±–ª–æ–∫–Ω–æ—Ç"  ‚ú® –ê–ö–¢–ò–í–û–í–ê–ù–û  –í–∏–∫–æ–Ω—É—î
# –°–ª—É—Ö–∞—î  –ß—É—î "–∑–∞–ø—É—Å—Ç–∏ –±—Ä–∞—É–∑–µ—Ä"  –Ü–≥–Ω–æ—Ä—É—î (–Ω–µ–º–∞—î "–∫–ª–∞—Ä–∞")
# –°–ª—É—Ö–∞—î  –ß—É—î —Ç–∏—à—É  –Ü–≥–Ω–æ—Ä—É—î
