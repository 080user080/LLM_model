# 🎧 Безперервний режим прослуховування

## Порівняння підходів

### ❌ Старий режим (циклічний)
```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ Запис 4с    │────▶│ Обробка     │────▶│ Запис 4с    │
│ (блокуючий) │     │ (затримка)  │     │ (блокуючий) │
└─────────────┘     └─────────────┘     └─────────────┘
```

**Проблеми:**
- ⏳ Треба чекати наступного циклу (до 4 секунд)
- 🔇 Асистент не чує під час обробки
- 😕 Незрозуміло чи слухає
- 🐌 Повільна реакція

---

### ✅ Новий режим (безперервний)
```
┌──────────────────────────────────────────────────────┐
│  Постійний стрім аудіо (background thread)           │
└──┬───────────────────────────────────────────────────┘
   │
   ├─▶ VAD детектує мовлення ──▶ Накопичує в буфері
   │
   ├─▶ Детектує паузу ──▶ Розпізнає текст
   │
   └─▶ Шукає ключові слова ──▶ Виконує команду (якщо знайдено)
```

**Переваги:**
- ⚡ Миттєва реакція (як тільки закінчив говорити)
- 👂 Завжди слухає (паралельна обробка)
- 🎯 Природне спілкування
- 🧠 Розумна детекція команд

---

## Як працює детекція команд

### 1. Ключові дієслова
Команда виконується якщо текст містить:
```
відкрий, відкрити, запусти, запустити
закрий, закрити, вимкни, вимкнути
скажи, розкажи, порахуй, обчисли
навчися, створи, зроби
пошукай, знайди, покажи
```

**Приклади:**
- ✅ "відкрий блокнот" → Виконає
- ✅ "треба закрити chrome" → Виконає
- ✅ "можеш порахувати 2 плюс 2" → Виконає
- ❌ "привіт як справи" → Ігнорує

### 2. Питальні слова
```
який, яка, яке, коли, де, хто, чому, скільки
```

**Приклади:**
- ✅ "який зараз час" → Виконає
- ✅ "де знаходиться файл" → Виконає
- ❌ "це цікаво" → Ігнорує

### 3. Звертання
```
чіп, chip, естрі, estri
```

**Приклади:**
- ✅ "Чіп, відкрий браузер" → Виконає
- ✅ "Естрі покажи погоду" → Виконає

---

## Налаштування

### 📝 config.py

```python
CONTINUOUS_MODE = {
    # VAD налаштування
    "speech_threshold": 0.5,  # 👈 Поріг детекції мовлення
    # Вище = менше хибних спрацювань, але може не детектувати тихе мовлення
    # Нижче = детектує тихше мовлення, але може ловити шум
    
    "silence_duration": 0.8,  # 👈 Секунд тиші = кінець речення
    # Більше = чекає довше перед обробкою (для довгих пауз)
    # Менше = швидша реакція (але може різати речення навпіл)
    
    # Буфер
    "max_buffer_seconds": 10,  # 👈 Максимальна довжина буфера
    # Якщо говориш довше 10с, старі дані будуть втрачені
    
    "min_speech_duration": 0.5,  # 👈 Мінімальна тривалість для обробки
    # Ігнорує звуки коротші за 0.5с (кашель, клацання тощо)
    
    # Команди
    "command_cooldown": 1.0,  # 👈 Секунд між командами
    # Запобігає спаму команд
}
```

---

## Типові сценарії налаштування

### 🎯 Тихий голос / далекий мікрофон
```python
"speech_threshold": 0.3,  # Нижчий поріг
"silence_duration": 1.0,   # Довша пауза
```

### ⚡ Швидка реакція
```python
"silence_duration": 0.5,   # Коротша пауза
"min_speech_duration": 0.3,
```

### 🔇 Шумне середовище
```python
"speech_threshold": 0.7,   # Вищий поріг
"min_speech_duration": 0.7,
```

### 🗣️ Повільне мовлення з паузами
```python
"silence_duration": 1.5,   # Дуже довга пауза
"max_buffer_seconds": 15,  # Більший буфер
```

---

## Додавання власних ключових слів

### logic_continuous_listener.py

```python
# Дієслова-команди
self.command_triggers = [
    'відкрий', 'відкрити', 'запусти',
    'покажи', 'налаштуй', 'змінити',  # ← Додай свої
]

# Звертання
self.address_words = [
    'чіп', 'chip', 
    'асистент', 'помічник',  # ← Додай свої
]
```

---

## Моніторинг роботи

### Що ти побачиш в логах:

```bash
🎧 Слухаю безперервно...

🗣️  Детектую мовлення... ✓
🔊 Обробка 2.3с мовлення...
📝 Розпізнано: відкрий блокнот

============================================================
✨ КОМАНДА ВИЯВЛЕНА!
💬 відкрий блокнот
============================================================

🤔 [Думаю...]
🤖 [Чіп]: ✅ Відкрито notepad
⏱️  1.23с

🎧 Продовжую слухати...
```

### Якщо не команда:

```bash
🗣️  Детектую мовлення... ✓
🔊 Обробка 1.8с мовлення...
📝 Розпізнано: привіт як справи
⭕ Не команда, ігнорую
```

---

## Переваги vs Недоліки

### ✅ Переваги
- Природне спілкування (як з людиною)
- Не треба чекати циклів
- Реагує миттєво після паузи
- Фільтрує непотрібне автоматично
- Працює в background (не блокує)

### ⚠️ Потенційні проблеми
- Більше навантаження на CPU/GPU (але з RTX 5060 Ti - не проблема)
- Може детектувати фонову розмову (якщо мікрофон дуже чутливий)
- Треба правильно налаштувати пороги

---

## Порівняння ресурсів

### Старий режим:
- CPU: ~5% (у моменти запису)
- GPU: ~10% (у моменти розпізнавання)
- Пікове навантаження

### Новий режим:
- CPU: ~8% (постійно)
- GPU: ~15% (постійно)
- Рівномірне навантаження

**З RTX 5060 Ti це абсолютно не проблема!**

---

## FAQ

### ❓ Чому команда не виконується?
1. Перевір чи текст містить ключове слово
2. Збільш `silence_duration` якщо ріже речення
3. Зменш `speech_threshold` якщо не детектує голос

### ❓ Чому спрацьовує на шум?
1. Збільш `speech_threshold`
2. Збільш `min_speech_duration`
3. Перевір мікрофон (можливо занадто чутливий)

### ❓ Як повернутись до старого режиму?
У main.py закоментуй блок з `create_continuous_listener` і розкоментуй старий цикл `while`.

### ❓ Чи можна обидва режими одночасно?
Ні, але можна зробити перемикач через config.

---

## Підсумок

**Твоя ідея була правильною!** Безперервний режим - це стандарт для сучасних голосових асистентів (Alexa, Google Assistant, Siri). 

Це дає **природну взаємодію** без затримок і очікування. З твоїм RTX 5060 Ti це працюватиме ідеально! 🚀
